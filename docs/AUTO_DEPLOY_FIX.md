# è‡ªåŠ¨éƒ¨ç½²ä¿®å¤502é”™è¯¯æŒ‡å—

## ğŸ¯ ç›®æ ‡

é€šè¿‡é‡æ–°éƒ¨ç½² `axi-star-cloud` é¡¹ç›®æ¥è‡ªåŠ¨ä¿®å¤502é”™è¯¯ï¼Œæ— éœ€æ‰‹åŠ¨æ‰§è¡Œè„šæœ¬ã€‚

## ğŸ“‹ éƒ¨ç½²é…ç½®

### éƒ¨ç½²å‚æ•°

ä½¿ç”¨ä»¥ä¸‹å‚æ•°é€šè¿‡ `axi-deploy` é‡æ–°éƒ¨ç½²ï¼š

- **é¡¹ç›®åç§°**: `axi-star-cloud`
- **æºä»“åº“**: `MoseLu/axi-star-cloud`
- **éƒ¨ç½²ç±»å‹**: `backend`
- **éƒ¨ç½²é…ç½®**: ä½¿ç”¨ `deploy-config.json` ä¸­çš„é…ç½®

### éƒ¨ç½²é…ç½®è¯¦æƒ…

```json
{
  "nginx_config": "å®Œæ•´çš„Nginxé…ç½®ï¼ŒåŒ…å«APIä»£ç†åˆ°ç«¯å£8124",
  "start_cmd": "systemctl restart star-cloud",
  "service_port": "8124",
  "test_url": "https://redamancy.com.cn/health",
  "mysql_config": "",
  "skip_init": false
}
```

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### 1. å‡†å¤‡éƒ¨ç½²é…ç½®

å°† `deploy-config.json` çš„å†…å®¹è¿›è¡Œ base64 ç¼–ç ï¼š

```bash
# åœ¨æœ¬åœ°æ‰§è¡Œ
cat deploy-config.json | base64 -w 0
```

### 2. é€šè¿‡GitHub Actionséƒ¨ç½²

è®¿é—® `axi-deploy` ä»“åº“çš„ Actions é¡µé¢ï¼Œæ‰‹åŠ¨è§¦å‘ `Main Deployment` å·¥ä½œæµï¼š

**è¾“å…¥å‚æ•°**ï¼š
- `project`: `axi-star-cloud`
- `source_repo`: `MoseLu/axi-star-cloud`
- `run_id`: æœ€æ–°çš„æ„å»ºè¿è¡ŒID
- `deploy_type`: `backend`
- `deploy_secrets`: æ‚¨çš„æœåŠ¡å™¨å¯†é’¥ï¼ˆJSONæ ¼å¼ï¼‰
- `deploy_config`: base64ç¼–ç çš„é…ç½®ï¼ˆä»æ­¥éª¤1è·å¾—ï¼‰

### 3. éƒ¨ç½²æµç¨‹

éƒ¨ç½²è¿‡ç¨‹å°†è‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

1. **éªŒè¯æ„å»ºäº§ç‰©** - æ£€æŸ¥æ„å»ºæ˜¯å¦æˆåŠŸ
2. **è§£æé…ç½®** - è§£æéƒ¨ç½²é…ç½®å’Œå¯†é’¥
3. **æœåŠ¡å™¨åˆå§‹åŒ–** - ç¡®ä¿æœåŠ¡å™¨ç¯å¢ƒæ­£ç¡®
4. **åŠ¨æ€ç«¯å£åˆ†é…** - åˆ†é…ç«¯å£8124
5. **éƒ¨ç½²é¡¹ç›®** - ä¸Šä¼ å’Œéƒ¨ç½²é¡¹ç›®æ–‡ä»¶
6. **é…ç½®Nginx** - åº”ç”¨æ­£ç¡®çš„Nginxé…ç½®
7. **å¯åŠ¨æœåŠ¡** - é‡å¯star-cloudæœåŠ¡
8. **æµ‹è¯•ç½‘ç«™** - éªŒè¯éƒ¨ç½²æ˜¯å¦æˆåŠŸ

## ğŸ”§ ä¿®å¤å†…å®¹

### Nginxé…ç½®ä¿®å¤

éƒ¨ç½²å°†è‡ªåŠ¨åº”ç”¨ä»¥ä¸‹Nginxé…ç½®ï¼š

```nginx
# API è·¯ç”± - ä»£ç†åˆ°åç«¯æœåŠ¡ (ç«¯å£8124)
location /api/ {
    proxy_pass http://127.0.0.1:8124;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    
    # CORS æ”¯æŒ
    add_header Access-Control-Allow-Origin *;
    add_header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS";
    add_header Access-Control-Allow-Headers "Origin, Content-Type, Accept, Authorization, User-UUID";
    add_header Access-Control-Allow-Credentials true;
}
```

### æœåŠ¡å¯åŠ¨ä¿®å¤

```bash
# è‡ªåŠ¨é‡å¯æœåŠ¡
systemctl restart star-cloud
```

### ç«¯å£é…ç½®ä¿®å¤

ç¡®ä¿æœåŠ¡è¿è¡Œåœ¨æ­£ç¡®çš„ç«¯å£ï¼š
- **åç«¯ç«¯å£**: 8124
- **å‰ç«¯è®¿é—®**: https://redamancy.com.cn

## ğŸ“Š é¢„æœŸç»“æœ

### éƒ¨ç½²å‰
- âŒ APIè¯·æ±‚è¿”å›502é”™è¯¯
- âŒ Nginxé…ç½®ç¼ºå¤±æˆ–é”™è¯¯
- âŒ ç«¯å£ä»£ç†é…ç½®ä¸æ­£ç¡®

### éƒ¨ç½²å
- âœ… APIè¯·æ±‚æ­£å¸¸å“åº”
- âœ… Nginxæ­£ç¡®ä»£ç†åˆ°ç«¯å£8124
- âœ… CORSé—®é¢˜è§£å†³
- âœ… æœåŠ¡è‡ªåŠ¨é‡å¯
- âœ… å¥åº·æ£€æŸ¥é€šè¿‡

## ğŸ” éªŒè¯æ­¥éª¤

éƒ¨ç½²å®Œæˆåï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼éªŒè¯ï¼š

### 1. å¥åº·æ£€æŸ¥
```bash
curl -I https://redamancy.com.cn/health
```

### 2. APIæµ‹è¯•
```bash
curl -I https://redamancy.com.cn/api/auth/validate
```

### 3. å‰ç«¯è®¿é—®
è®¿é—® https://redamancy.com.cn æ£€æŸ¥æ˜¯å¦æ­£å¸¸åŠ è½½

### 4. æµè§ˆå™¨å¼€å‘è€…å·¥å…·
æ£€æŸ¥Networkæ ‡ç­¾é¡µï¼Œç¡®è®¤APIè¯·æ±‚ä¸å†è¿”å›502é”™è¯¯

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¦‚æœéƒ¨ç½²å¤±è´¥

1. **æ£€æŸ¥æ„å»ºçŠ¶æ€**
   - ç¡®ä¿ `axi-star-cloud` é¡¹ç›®æ„å»ºæˆåŠŸ
   - è·å–æ­£ç¡®çš„ `run_id`

2. **æ£€æŸ¥æœåŠ¡å™¨è¿æ¥**
   - ç¡®ä¿æœåŠ¡å™¨å¯†é’¥æ­£ç¡®
   - æ£€æŸ¥æœåŠ¡å™¨ç½‘ç»œè¿æ¥

3. **æ£€æŸ¥ç«¯å£å†²çª**
   - ç¡®ä¿ç«¯å£8124æœªè¢«å…¶ä»–æœåŠ¡å ç”¨
   - æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

### å¦‚æœéƒ¨ç½²æˆåŠŸä½†ä»æœ‰é—®é¢˜

1. **æ£€æŸ¥æœåŠ¡çŠ¶æ€**
   ```bash
   systemctl status star-cloud
   ```

2. **æ£€æŸ¥ç«¯å£ç›‘å¬**
   ```bash
   netstat -tlnp | grep 8124
   ```

3. **æ£€æŸ¥Nginxé…ç½®**
   ```bash
   nginx -t
   systemctl status nginx
   ```

4. **æŸ¥çœ‹æ—¥å¿—**
   ```bash
   journalctl -u star-cloud -f
   tail -f /var/log/nginx/error.log
   ```

## ğŸ“ ä¼˜åŠ¿

### è‡ªåŠ¨åŒ–éƒ¨ç½²çš„ä¼˜åŠ¿

1. **ä¸€é”®ä¿®å¤** - æ— éœ€æ‰‹åŠ¨æ‰§è¡Œè„šæœ¬
2. **é…ç½®ç»Ÿä¸€** - æ‰€æœ‰é…ç½®é›†ä¸­ç®¡ç†
3. **ç‰ˆæœ¬æ§åˆ¶** - é…ç½®å˜æ›´å¯è¿½è¸ª
4. **å›æ»šæ”¯æŒ** - å¯ä»¥å¿«é€Ÿå›æ»šåˆ°ä¹‹å‰ç‰ˆæœ¬
5. **ç¯å¢ƒä¸€è‡´** - ç¡®ä¿æ‰€æœ‰ç¯å¢ƒé…ç½®ä¸€è‡´

### ä¸ä¼ ç»Ÿä¿®å¤çš„å¯¹æ¯”

| æ–¹å¼ | è‡ªåŠ¨åŒ–éƒ¨ç½² | æ‰‹åŠ¨è„šæœ¬ |
|------|------------|----------|
| æ“ä½œå¤æ‚åº¦ | ç®€å• | ä¸­ç­‰ |
| é…ç½®ç®¡ç† | é›†ä¸­åŒ– | åˆ†æ•£åŒ– |
| ç‰ˆæœ¬æ§åˆ¶ | æ”¯æŒ | ä¸æ”¯æŒ |
| å›æ»šèƒ½åŠ› | å¼º | å¼± |
| ç¯å¢ƒä¸€è‡´æ€§ | é«˜ | ä½ |

## ğŸ‰ æ€»ç»“

é€šè¿‡é‡æ–°éƒ¨ç½² `axi-star-cloud` é¡¹ç›®ï¼Œå¯ä»¥è‡ªåŠ¨ä¿®å¤502é”™è¯¯é—®é¢˜ã€‚è¿™ç§æ–¹å¼æ›´åŠ è§„èŒƒã€å¯é ï¼Œå¹¶ä¸”æ”¯æŒç‰ˆæœ¬æ§åˆ¶å’Œå›æ»šã€‚

éƒ¨ç½²å®Œæˆåï¼Œæ‚¨çš„ç½‘ç«™åº”è¯¥èƒ½å¤Ÿæ­£å¸¸è®¿é—®ï¼ŒAPIè¯·æ±‚ä¸å†è¿”å›502é”™è¯¯ã€‚
