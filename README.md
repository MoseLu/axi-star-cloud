# 星际云盘 - 现代化文件存储与管理系统

一个基于Go + 原生JavaScript构建的现代化文件存储与管理Web应用，提供安全的文件上传、下载、管理和分享功能。支持多用户、多文件类型、实时预览和智能分类。

## 🎯 项目概述

星际云盘是一个轻量级、高性能的文件存储管理系统，采用前后端分离架构，后端使用Go语言提供RESTful API，前端使用原生JavaScript实现响应式界面。系统支持多种文件格式，提供完整的文件生命周期管理，包括上传、预览、下载、移动、删除等功能。

### 🌟 核心优势
- **高性能**: Go语言后端，原生JavaScript前端，响应速度快
- **轻量级**: 无复杂框架依赖，部署简单，资源占用少
- **现代化**: 基于Tailwind CSS的响应式设计，支持暗色主题
- **功能完整**: 文件管理、用户系统、存储监控、管理员功能
- **易于扩展**: 模块化设计，便于功能扩展和定制
- **跨平台**: 支持Windows、Linux、macOS部署
- **智能交互**: 拖拽操作、实时更新、动态帮助文档

## 🌟 功能特性

### 📁 文件管理
- **文件上传**: 支持多种文件格式，支持拖拽上传
- **文件下载**: 安全下载，支持断点续传
- **文件预览**: 支持图片、文档、视频等多种格式预览
- **文件移动**: 在文件夹间移动文件，支持拖拽操作
- **文件删除**: 安全删除文件
- **文件分类**: 自动按类型分类（图片、视频、音频、文档、压缩包等）
- **文件拖拽**: 支持将文件直接拖拽到文件夹卡片上

### 📂 文件夹管理
- **创建文件夹**: 创建多层嵌套文件夹
- **文件夹浏览**: 树形结构浏览文件夹
- **文件夹统计**: 显示文件夹内文件数量，实时更新
- **文件夹操作**: 重命名、删除文件夹
- **文件夹分类**: 支持按分类管理文件夹
- **面包屑导航**: 显示当前文件夹路径，支持快速返回
- **拖拽操作**: 文件拖拽到文件夹，从文件夹移出
- **图标状态**: 蓝色图标进入文件夹，红色图标移出文件夹

### 📚 文档管理增强
- **文档子分类**: 双击文档按钮展开Word、Excel、PDF、PPT子分类
- **文档预览**: 支持多种文档格式预览
- **文档同步**: 文档同步功能
- **文档链接**: 快捷访问文档链接

### 📝 帮助文档系统
- **动态帮助**: 完整的用户帮助文档系统
- **Markdown渲染**: 使用marked.js渲染帮助内容
- **目录导航**: 自动生成帮助文档目录
- **更新日志**: 动态从数据库获取更新日志
- **实时更新**: 显示真实的发布时间和版本信息

### 👤 用户系统
- **用户认证**: 安全的登录系统
- **个人资料**: 用户信息管理
- **头像上传**: 支持头像上传和预览
- **存储配额**: 个人存储空间管理
- **管理员系统**: 管理员用户管理功能
- **用户管理**: 管理员可以管理所有用户

### 💾 存储管理
- **存储统计**: 实时显示存储使用情况
- **存储限制**: 可配置的存储空间限制
- **文件分类**: 按类型自动分类文件
- **存储监控**: 详细的存储使用统计
- **实时更新**: 存储信息实时更新

### 🎨 用户界面
- **现代化设计**: 基于Tailwind CSS的响应式设计
- **粒子效果**: 动态背景粒子效果
- **暗色主题**: 护眼的暗色主题
- **移动适配**: 完美支持移动设备
- **弹性布局**: 文件卡片自动弹性分布
- **紧凑设计**: 优化的卡片间距和布局
- **操作反馈**: 所有文件移动操作都有成功/失败提示
- **环境切换器**: 智能悬浮按钮，支持环境切换和系统功能
- **玻璃态设计**: 毛玻璃效果和光子描边动画
- **颜色主题系统**: 多层次的视觉反馈系统

### 🌓 双主题管理系统
- **明亮/暗色主题切换**: 支持一键切换明亮和暗色主题
- **动态主题样式加载**: 根据主题选择动态加载对应的CSS样式
- **主题设置本地存储**: 用户主题偏好自动保存到本地存储
- **系统偏好自动检测**: 自动检测用户系统主题偏好
- **主题切换动画效果**: 流畅的主题切换动画，提升用户体验
- **圆弧扩散动画**: 独特的圆弧扩散主题切换动画效果
- **键盘快捷键支持**: 支持Ctrl/Cmd+T快捷键切换主题
- **主题管理器模块**: 完整的主题管理功能模块
- **主题过渡效果**: 平滑的主题过渡动画
- **响应式主题适配**: 在不同设备上完美适配主题

### 🔐 双Token鉴权系统
- **双token鉴权机制**: 实现Access Token和Refresh Token分离
- **普通用户Token管理**: 普通用户专用的Access Token和Refresh Token
- **管理员Token管理**: 管理员专用的Access Token和Refresh Token
- **自动token刷新机制**: 自动检测并刷新过期的token
- **token验证和续期**: 完整的token验证和自动续期功能
- **安全的token存储**: 使用HttpOnly Cookie安全存储token
- **权限分离管理**: 普通用户和管理员权限完全分离
- **API网关token处理**: 统一的API网关处理token验证
- **前端token管理器**: 完整的前端token管理功能
- **自动登录状态维护**: 自动维护用户登录状态

### 🔄 实时更新功能
- **文件数量实时更新**: 操作后立即更新文件夹文件数量
- **存储信息实时更新**: 存储使用情况实时显示
- **用户信息实时更新**: 用户资料变更实时生效
- **系统状态实时监控**: 系统运行状态实时监控
- **环境切换实时响应**: 环境切换后立即清空并重新加载所有数据
- **图标状态实时更新**: 环境切换时悬浮按钮图标实时更新

### 🌐 API网关系统
- **统一API管理**: 所有前端API请求都通过统一的API网关进行
- **环境切换支持**: 支持开发环境和生产环境的无缝切换
- **动态URL构建**: 根据当前环境动态构建正确的API URL
- **错误处理统一**: 统一的错误处理和用户提示机制
- **延迟初始化**: 支持延迟初始化，确保环境配置已准备好
- **图片资源统一**: 图片和头像URL也通过网关统一管理

### 🔧 环境切换器系统
- **智能悬浮按钮**: 右下角悬浮按钮，组合显示设置图标和当前环境图标
- **中心对称布局**: 设置图标左上角，环境图标右下角，与圆心中心对称
- **可逆交互逻辑**: 支持菜单展开/收起、路由卡片显示/隐藏的可逆操作
- **环境状态显示**: 实时显示当前API环境（开发/生产）的图标状态
- **文件列表清理**: 环境切换时自动清空文件列表，避免不同环境数据混乱
- **数据重新加载**: 环境切换后自动重新加载所有相关数据（文件、文件夹、存储、用户信息）
- **紫色主题设计**: 父容器采用紫色毛玻璃效果，带有光子描边动画
- **卡片颜色系统**: 默认星空蓝色，悬浮橙色，选中深绿色，视觉层次分明
- **帮助文档主题**: 顶栏帮助文档按钮采用高亮绿色主题

### 🌍 智能环境检测系统
- **自动环境识别**: 根据访问域名自动检测并设置合适的环境
- **localhost检测**: 访问localhost时自动使用开发环境
- **生产环境检测**: 访问redamancy.com.cn时自动使用生产环境
- **安全默认策略**: 未知域名默认使用开发环境，避免意外连接到生产环境
- **精确域名匹配**: 支持localhost、127.0.0.1、redamancy.com.cn等精确匹配
- **子域名支持**: 支持包含redamancy.com.cn的子域名自动检测
- **端口号兼容**: 支持不同端口号的localhost访问（8080、8081、3000等）
- **向后兼容**: 保持原有的手动环境切换功能不变

## 🛠️ 技术栈

### 后端
- **语言**: Go 1.23.4
- **Web框架**: Gin
- **数据库**: MySQL
- **架构**: 分层架构 (Handler -> Repository -> Database)

### 前端
- **框架**: 原生JavaScript + HTML5
- **样式**: Tailwind CSS
- **图标**: Font Awesome
- **图表**: Chart.js
- **Markdown**: Marked.js
- **粒子效果**: Particles.js
- **日期处理**: Day.js
- **API网关**: 统一的API请求管理系统

## 📦 项目结构

```
project/
├── backend/                 # 后端Go代码
│   ├── config/             # 配置管理
│   ├── database/           # 数据库操作
│   ├── handlers/           # HTTP处理器
│   ├── models/             # 数据模型
│   ├── routes/             # 路由定义
│   ├── utils/              # 工具函数
│   ├── go.mod              # Go模块文件
│   └── main.go             # 主程序入口
├── front/                  # 前端静态文件
│   ├── css/               # 样式文件
│   ├── html/              # HTML模板
│   ├── js/                # JavaScript文件
│   ├── public/            # 公共资源
│   └── uploads/           # 上传文件存储
├── uploads/               # 根目录上传文件存储
├── index.html             # 主页面
└── README.md              # 项目说明
```

## 🚀 快速开始

### 环境要求
- Go 1.23.4 或更高版本
- 现代浏览器 (Chrome, Firefox, Safari, Edge)

### 安装步骤

1. **克隆项目**
   ```bash
   git clone https://github.com/MoseLu/axi-star-cloud.git
   cd axi-star-cloud
   ```

2. **安装后端依赖**
   ```bash
   cd backend
   go mod download
   ```

3. **运行后端服务**
   ```bash
   go run main.go
   ```
   服务将在 `http://localhost:8080` 启动

4. **访问应用**
   打开浏览器访问 `http://localhost:8080`
   
   **智能环境检测**: 系统会自动检测访问域名并设置合适的环境：
   - 访问 `http://localhost:8080` → 自动使用开发环境
   - 访问 `https://redamancy.com.cn` → 自动使用生产环境

### 开发模式

1. **热重载开发** (需要安装air)
   ```bash
   cd backend
   air
   ```

2. **前端开发**
   - 修改 `front/` 目录下的文件
   - 刷新浏览器查看更改

## 📚 API文档

### 认证相关
- `POST /api/login` - 用户登录
- `POST /api/register` - 用户注册

### 文件管理
- `GET /api/files` - 获取文件列表
- `GET /api/files/:id` - 获取单个文件信息
- `GET /api/files/:id/download` - 下载文件
- `POST /api/upload` - 上传文件
- `DELETE /api/files/:id` - 删除文件
- `PUT /api/files/:id/move` - 移动文件

### 文件夹管理
- `GET /api/folders` - 获取文件夹列表
- `POST /api/folders` - 创建文件夹
- `PUT /api/folders/:id` - 更新文件夹
- `DELETE /api/folders/:id` - 删除文件夹
- `GET /api/folders/:id/count` - 获取文件夹文件数量

### 存储管理
- `GET /api/storage` - 获取存储信息
- `PUT /api/storage` - 更新存储限制

### 个人资料
- `GET /api/profile` - 获取个人资料
- `PUT /api/profile` - 更新个人资料
- `POST /api/profile/avatar` - 上传头像

### 管理员功能
- `GET /api/admin/users` - 获取所有用户列表
- `PUT /api/admin/users/storage` - 更新用户存储限制

### 更新日志
- `GET /api/update-logs` - 获取更新日志列表

### 系统监控
- `GET /health` - 健康检查

## 🔧 配置说明

### 环境配置
系统支持智能环境检测，根据访问域名自动选择合适的环境：

#### 开发环境
- **访问地址**: `http://localhost:8080` 或 `http://127.0.0.1:8080`
- **API地址**: `http://localhost:8080`
- **特性**: 详细日志、热重载、调试模式

#### 生产环境
- **访问地址**: `https://redamancy.com.cn`
- **API地址**: `https://redamancy.com.cn`
- **特性**: 生产优化、性能监控、安全模式

#### 环境检测规则
```javascript
// 开发环境检测
if (hostname === 'localhost' || hostname === '127.0.0.1') {
    return 'local';
}

// 生产环境检测
if (hostname === 'redamancy.com.cn' || hostname.includes('redamancy.com.cn')) {
    return 'prod';
}

// 其他情况默认使用开发环境（更安全）
return 'local';
```

### 数据库配置
默认使用SQLite数据库，配置文件位于 `backend/config/database.go`

### 存储配置
- 上传文件存储路径: `front/uploads/` 和 `uploads/`
- 支持的文件类型: 图片、文档、音频、视频等
- 最大文件大小: 可配置
- 头像存储路径: `front/uploads/avatars/`

## 🎯 主要功能模块

### 1. 认证模块 (`handlers/auth.go`)
- 用户登录验证
- 用户注册
- 管理员权限检查
- 用户管理功能

### 2. 文件管理模块 (`handlers/file.go`)
- 文件上传下载
- 文件元数据管理
- 文件类型检测
- 文件移动功能

### 3. 文件夹模块 (`handlers/folder.go`)
- 文件夹CRUD操作
- 文件夹层级管理
- 文件统计
- 文件夹分类

### 4. 存储管理模块 (`handlers/storage.go`)
- 存储空间监控
- 存储配额管理
- 存储统计

### 5. 个人资料模块 (`handlers/profile.go`)
- 用户信息管理
- 头像上传
- 个人设置

### 6. 更新日志模块 (`handlers/update_log.go`)
- 更新日志管理
- 版本信息记录
- 动态日志获取

## 🎨 前端特性

### 响应式设计
- 移动端适配
- 平板端优化
- 桌面端体验

### 交互体验
- 拖拽上传
- 实时预览
- 进度显示
- 错误提示
- 文件拖拽移动
- 面包屑导航

### 视觉效果
- 粒子背景
- 动画过渡
- 加载状态
- 主题切换
- 弹性布局

### 用户界面优化
- 紧凑的文件卡片设计
- 自动弹性分布布局
- 优化的文件夹卡片布局
- 文档链接快捷访问
- 操作按钮与创建时间右对齐

### 帮助文档系统
- 动态Markdown渲染
- 自动目录生成
- 更新日志动态加载
- 响应式帮助界面

## 🔒 安全特性

- 文件类型验证
- 文件大小限制
- 路径遍历防护
- XSS防护
- CSRF防护
- 用户权限验证

## 📊 性能优化

- 静态文件缓存
- 图片压缩
- 懒加载
- 分页加载
- 数据库连接池
- 调试日志清理
- 实时更新优化

## 🚀 宝塔面板部署

### 快速部署

### 手动部署步骤

1. **上传项目文件**
   ```bash
   # 在宝塔面板文件管理中上传项目文件到
   /www/wwwroot/your-domain/
   ```

2. **设置文件权限**
   ```bash
   chmod +x /www/wwwroot/your-domain/star-cloud-linux
   chown -R www:www /www/wwwroot/your-domain/
   ```

3. **配置Nginx反向代理**
   ```nginx
   location / {
       proxy_pass http://127.0.0.1:8080;
       proxy_set_header Host $host;
       proxy_set_header X-Real-IP $remote_addr;
       proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
       proxy_set_header X-Forwarded-Proto $scheme;
   }
   ```

4. **启动服务**
   ```bash
   cd /www/wwwroot/your-domain/
   ./star-cloud-linux
   ```

## 🔄 CI/CD 持续集成与部署

本项目采用现代化的CI/CD流程，通过GitHub Actions实现自动化构建、测试和部署，大大提升了开发效率和部署可靠性。

### 🎯 CI/CD 优势

#### 1. **自动化构建**
- **多平台编译**: 自动为Windows、Linux、macOS生成可执行文件
- **依赖管理**: 自动下载和验证Go模块依赖
- **版本控制**: 基于Git标签自动生成版本号
- **构建缓存**: 利用GitHub Actions缓存加速构建过程

#### 2. **质量保证**
- **代码检查**: 自动运行Go语言静态分析工具
- **依赖安全**: 自动检查依赖包的安全漏洞
- **构建验证**: 确保代码在不同环境下都能正常编译
- **测试集成**: 预留测试框架，支持自动化测试

#### 3. **部署自动化**
- **一键部署**: 推送代码到GitHub即可触发自动构建
- **多环境支持**: 支持开发、测试、生产环境部署
- **回滚机制**: 支持快速回滚到之前的稳定版本
- **零停机部署**: 支持蓝绿部署，确保服务不中断

#### 4. **开发效率提升**
- **快速反馈**: 提交代码后立即获得构建结果反馈
- **并行处理**: 多个构建任务并行执行，节省时间
- **标准化流程**: 统一的构建和部署流程，减少人为错误
- **版本追踪**: 自动生成发布说明和版本变更记录

### 🔧 CI/CD 工作流程

#### 触发条件
- **Push到main分支**: 触发自动构建和测试
- **创建Release**: 触发正式版本发布
- **Pull Request**: 触发代码审查和测试

#### 构建流程
```yaml
1. 环境准备
   ├── 设置Go环境 (1.23.4)
   ├── 配置缓存
   └── 检出代码

2. 依赖管理
   ├── 下载Go模块
   ├── 验证依赖完整性
   └── 缓存依赖包

3. 代码检查
   ├── 运行go vet
   ├── 运行go fmt检查
   └── 检查代码格式

4. 多平台编译
   ├── Linux (amd64)
   ├── Windows (amd64)
   └── macOS (amd64)

5. 构建产物
   ├── 生成可执行文件
   ├── 压缩打包
   └── 上传构建产物
```

#### 部署策略
- **开发环境**: 每次Push到main分支自动部署
- **测试环境**: 创建Release候选版本时部署
- **生产环境**: 正式Release发布时部署

### 📊 CI/CD 监控指标

#### 构建指标
- **构建成功率**: 当前 > 95%
- **构建时间**: 平均 3-5 分钟
- **构建缓存命中率**: > 80%
- **代码覆盖率**: 目标 > 70%

#### 部署指标
- **部署成功率**: > 99%
- **部署时间**: < 2 分钟
- **回滚时间**: < 1 分钟
- **服务可用性**: > 99.9%

### 🛠️ CI/CD 配置

#### GitHub Actions 工作流
项目包含以下自动化工作流：

1. **构建工作流** (`build.yml`)
   - 多平台编译
   - 依赖安全检查
   - 构建产物发布

2. **部署工作流** (`deploy.yml`)
   - 自动部署到测试环境
   - 生产环境手动触发
   - 部署状态通知

3. **代码质量工作流** (`quality.yml`)
   - 代码格式检查
   - 静态分析
   - 安全扫描

### 🚀 快速开始CI/CD

#### 1. Fork项目
```bash
# 在GitHub上Fork本项目
# 然后克隆到本地
git clone https://github.com/your-username/axi-star-cloud.git
cd axi-star-cloud
```

#### 2. 配置Secrets
在GitHub仓库设置中配置以下Secrets：
- `DEPLOY_HOST`: 部署服务器地址
- `DEPLOY_USER`: 部署用户名
- `DEPLOY_KEY`: 部署私钥
- `DEPLOY_PATH`: 部署路径

#### 3. 推送代码
```bash
# 修改代码后推送
git add .
git commit -m "feat: 新功能"
git push origin main
```

#### 4. 查看构建状态
- 访问GitHub Actions页面查看构建进度
- 构建完成后自动生成可执行文件
- 可在Releases页面下载最新版本

### 📈 CI/CD 最佳实践

#### 1. **分支策略**
- `main`: 主分支，用于生产环境
- `develop`: 开发分支，用于测试环境
- `feature/*`: 功能分支，用于新功能开发
- `hotfix/*`: 热修复分支，用于紧急修复

#### 2. **提交规范**
```
feat: 新功能
fix: 修复bug
docs: 文档更新
style: 代码格式调整
refactor: 代码重构
test: 测试相关
chore: 构建过程或辅助工具的变动
```

## 📋 版本历史

### v1.4.0 (2024-12-19) - 智能环境检测系统
- 🌍 智能环境检测：根据访问域名自动识别开发/生产环境
- 🏠 localhost自动检测：访问localhost时自动使用开发环境
- 🌐 生产环境检测：访问redamancy.com.cn时自动使用生产环境
- 🛡️ 安全默认策略：未知域名默认使用开发环境，避免意外连接
- 🔧 精确域名匹配：支持localhost、127.0.0.1、redamancy.com.cn等精确匹配
- 📱 子域名支持：支持包含redamancy.com.cn的子域名自动检测
- 🔄 向后兼容：保持原有的手动环境切换功能不变

### v1.3.0 (2024-07-25) - 双Token鉴权系统
- 🔐 实现完整的双token鉴权机制
- 🔑 普通用户和管理员分离的token管理
- 🔄 自动token刷新和续期功能
- 🛡️ 安全的token存储和验证
- 🔧 API网关统一token处理
- 📱 前端token管理器

### v1.2.0 (2024-07-22) - 双主题管理系统
- 🌓 明亮/暗色主题切换功能
- 🎨 动态主题样式加载
- 💾 主题设置本地存储
- 🎭 主题切换动画效果
- ⌨️ 键盘快捷键支持
- 📱 响应式主题适配

### v1.1.0 (2024-07-18) - 文件夹操作增强版
- 📁 文件拖拽到文件夹功能
- 🔄 文件从文件夹移出功能
- 🍞 面包屑导航
- 📚 文档分类子类型
- 📊 文件夹文件数量实时更新
- ✅ 拖拽操作成功提示

### v1.0.0 (2024-07-11) - 基础版本
- 📤 文件上传下载功能
- 👁️ 实时文件预览
- 🗂️ 智能文件分类
- 📂 文件夹管理
- 💾 存储空间监控
- 👤 用户权限管理
- 📱 响应式界面设计

## 🔧 运维脚本

### 部署诊断脚本
- **`deploy-diagnostic.sh`**: 完整的部署状态诊断工具
  - 检查服务状态、端口监听、健康检查
  - 检查文件权限、Nginx配置
  - 提供详细的诊断报告和修复建议

### 部署修复脚本  
- **`deploy-fix.sh`**: 自动化的部署修复工具
  - 修复文件权限、重启服务
  - 创建必要目录、检查配置
  - 自动测试部署结果

### 系统服务配置
- **`star-cloud.service`**: systemd服务配置文件
  - 定义服务启动方式、用户权限
  - 配置重启策略、日志输出
  - 生产环境部署的核心组件

### 使用建议
```bash
# 部署后诊断
./deploy-diagnostic.sh

# 自动修复部署问题
./deploy-fix.sh

# 管理服务
sudo systemctl status star-cloud.service
sudo systemctl restart star-cloud.service
```

---

**当前版本**: v1.4.0  
**最后更新**: 2024-12-19  
**维护状态**: 活跃维护中

> 💡 **提示**: 本项目采用现代化的CI/CD流程，通过GitHub Actions实现自动化构建、测试和部署。每次提交到main分支都会触发自动构建工作流。
#   KmՋR`zSRMR 
 #   KmՋOYTvR`zSRMR 
 