<!-- æ¬¢è¿ä¿¡æ¯ -->
<div class="mb-8">
    <div class="glass-effect rounded-2xl p-4 md:p-8 shadow-xl relative overflow-hidden welcome-section-card" id="welcome-section-card">
        <!-- èƒŒæ™¯è£…é¥°å·²åˆ é™¤ -->
        
        <div class="relative z-10">
            <!-- ç§»åŠ¨ç«¯ä¼˜åŒ–çš„å¤´éƒ¨å¸ƒå±€ -->
            <div class="welcome-header">
                <!-- å¤´åƒå’Œæ¬¢è¿ä¿¡æ¯ -->
                <div class="welcome-user-info">
                    <div class="avatar-section">
                        <div class="relative group">
                            <div class="profile-avatar" id="profile-avatar" title="ç‚¹å‡»ç¼–è¾‘ä¸ªäººèµ„æ–™">
                                <i class="fa fa-user-circle avatar-icon" id="avatar-icon"></i>
                                <img id="avatar-image" class="avatar-image hidden" alt="å¤´åƒ">
                            </div>
                            <!-- ç¼–è¾‘å›¾æ ‡æç¤º -->
                            <div class="edit-icon" title="ç¼–è¾‘ä¸ªäººèµ„æ–™">
                                <i class="fa fa-pencil"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="welcome-text">
                        <h1 class="welcome-title">
                            <span id="welcome-message">æ¬¢è¿å›æ¥ï¼Œç”¨æˆ·</span>
                        </h1>
                        <p class="welcome-date">ä»Šå¤©æ˜¯ <span id="current-date" class="text-purple-light font-medium"></span></p>
                    </div>
                </div>
                
                <!-- æ–‡ä»¶ç»Ÿè®¡å¡ç‰‡ -->
                <div class="file-stats-card">
                    <div class="stats-content">
                        <div class="stats-number" id="file-count">0</div>
                        <div class="stats-label">ä¸ªæ–‡ä»¶</div>
                    </div>
                </div>
            </div>
            
            <!-- çŠ¶æ€ä¿¡æ¯å¡ç‰‡ -->
            <div class="status-cards">
                <div class="status-card status-login">
                    <div class="status-icon">
                        <i class="fa fa-clock-o"></i>
                    </div>
                    <div class="status-info">
                        <div class="status-label">æœ€åç™»å½•</div>
                        <div class="status-value" id="last-login"></div>
                    </div>
                </div>
                
                <div class="status-card status-storage">
                    <div class="status-icon">
                        <i class="fa fa-cloud"></i>
                    </div>
                    <div class="status-info">
                        <div class="status-label">å­˜å‚¨çŠ¶æ€</div>
                        <div class="status-value" id="welcome-storage-status">--</div>
                    </div>
                </div>
                
                <script>
                    console.log('ğŸ’¾ æ¬¢è¿æ¨¡å—ï¼šè„šæœ¬å¼€å§‹æ‰§è¡Œ');
                    
                    let isInitialized = false;
                    
                    // ä»æœ¬åœ°ç¼“å­˜è¯»å–å­˜å‚¨çŠ¶æ€
                    function updateStorageStatusFromCache() {
                        console.log('ğŸ’¾ æ¬¢è¿æ¨¡å—ï¼šå¼€å§‹ä»ç¼“å­˜è¯»å–å­˜å‚¨çŠ¶æ€');
                        
                        // å°è¯•ä»æ–°çš„StorageManagerç»“æ„è¯»å–
                        let storageStatusData = null;
                        
                        // æ–¹æ³•1ï¼šä»StorageManagerè¯»å–
                        if (window.StorageManager && typeof window.StorageManager.getStorageStatus === 'function') {
                            storageStatusData = window.StorageManager.getStorageStatus();
                            console.log('ğŸ’¾ æ¬¢è¿æ¨¡å—ï¼šä»StorageManagerè¯»å–:', storageStatusData);
                        }
                        
                        // æ–¹æ³•2ï¼šä»systemInfoè¯»å–
                        if (!storageStatusData) {
                            const systemData = localStorage.getItem('systemInfo');
                            if (systemData) {
                                try {
                                    const systemInfo = JSON.parse(systemData);
                                    storageStatusData = systemInfo.storageStatus;
                                    console.log('ğŸ’¾ æ¬¢è¿æ¨¡å—ï¼šä»systemInfoè¯»å–:', storageStatusData);
                                } catch (error) {
                                    console.warn('è§£æsystemInfoå¤±è´¥:', error);
                                }
                            }
                        }
                        
                        // æ–¹æ³•3ï¼šä»æ—§çš„storageStatusé”®è¯»å–ï¼ˆå…¼å®¹æ€§ï¼‰
                        if (!storageStatusData) {
                            const oldData = localStorage.getItem('storageStatus');
                            if (oldData) {
                                try {
                                    storageStatusData = JSON.parse(oldData);
                                    console.log('ğŸ’¾ æ¬¢è¿æ¨¡å—ï¼šä»æ—§storageStatusè¯»å–:', storageStatusData);
                                } catch (error) {
                                    console.warn('è§£ææ—§storageStatuså¤±è´¥:', error);
                                }
                            }
                        }
                        
                        if (storageStatusData && storageStatusData.status) {
                            try {
                                console.log('ğŸ’¾ æ¬¢è¿æ¨¡å—ï¼šæœ€ç»ˆç¼“å­˜æ•°æ®:', storageStatusData);
                                const welcomeStorageStatus = document.getElementById('welcome-storage-status');
                                if (welcomeStorageStatus) {
                                    // ç¡®ä¿åªä½¿ç”¨statuså­—æ®µï¼Œé¿å…ä½¿ç”¨percentageå­—æ®µ
                                    let statusText = storageStatusData.status;
                                    
                                    // å¦‚æœstatusæ˜¯æ•°å­—æˆ–æ•°å­—å­—ç¬¦ä¸²ï¼Œè¯´æ˜å¯èƒ½æ˜¯é”™è¯¯çš„å­—æ®µ
                                    if (typeof statusText === 'number' || (typeof statusText === 'string' && !isNaN(parseFloat(statusText)))) {
                                        console.warn('ğŸ’¾ æ¬¢è¿æ¨¡å—ï¼šæ£€æµ‹åˆ°statuså­—æ®µä¸ºæ•°å­—ï¼Œå¯èƒ½æ˜¯é”™è¯¯çš„å­—æ®µæ˜ å°„');
                                        // å°è¯•ä»å…¶ä»–å­—æ®µè·å–æ­£ç¡®çš„çŠ¶æ€æ–‡æœ¬
                                        if (storageStatusData.remainingPercentage !== undefined) {
                                            const remainingPercentage = storageStatusData.remainingPercentage;
                                            if (remainingPercentage > 30) {
                                                statusText = 'å……è¶³';
                                            } else if (remainingPercentage >= 10) {
                                                statusText = 'ä¸è¶³';
                                            } else {
                                                statusText = 'ä¸¥é‡ä¸è¶³';
                                            }
                                        } else {
                                            // å¦‚æœæ²¡æœ‰å…¶ä»–å­—æ®µï¼Œä½¿ç”¨é»˜è®¤å€¼
                                            statusText = 'å……è¶³';
                                        }
                                    }
                                    
                                    welcomeStorageStatus.textContent = statusText;
                                    console.log(`ğŸ’¾ æ¬¢è¿æ¨¡å—ï¼šå·²ä»ç¼“å­˜è¯»å–å¹¶æ›´æ–°çŠ¶æ€: ${statusText}`);
                                    isInitialized = true;
                                } else {
                                    console.log('ğŸ’¾ æ¬¢è¿æ¨¡å—ï¼šDOMå…ƒç´ æœªæ‰¾åˆ°');
                                }
                            } catch (error) {
                                console.error('è§£æå­˜å‚¨çŠ¶æ€ç¼“å­˜å¤±è´¥:', error);
                            }
                        } else {
                            console.log('ğŸ’¾ æ¬¢è¿æ¨¡å—ï¼šæœ¬åœ°ç¼“å­˜ä¸­æ²¡æœ‰æœ‰æ•ˆçš„å­˜å‚¨çŠ¶æ€æ•°æ®');
                            // å¦‚æœæ²¡æœ‰ç¼“å­˜æ•°æ®ï¼Œç­‰å¾…å­˜å‚¨ç©ºé—´æ¦‚è§ˆæ¨¡å—æ›´æ–°
                            if (!isInitialized) {
                                setTimeout(() => {
                                    // å»¶è¿Ÿé‡è¯•ï¼Œç­‰å¾…å­˜å‚¨ç©ºé—´æ¦‚è§ˆæ¨¡å—åˆå§‹åŒ–
                                    updateStorageStatusFromCache();
                                }, 1000);
                            }
                        }
                    }
                    
                    // ç›‘å¬å­˜å‚¨çŠ¶æ€å˜åŒ–
                    function setupStorageStatusListener() {
                        // ç›‘å¬localStorageå˜åŒ–
                        window.addEventListener('storage', function(e) {
                            if (e.key === 'storageStatus' || e.key === 'systemInfo') {
                                console.log('ğŸ’¾ æ¬¢è¿æ¨¡å—ï¼šæ£€æµ‹åˆ°å­˜å‚¨çŠ¶æ€å˜åŒ–');
                                updateStorageStatusFromCache();
                            }
                        });
                        
                        // ç›‘å¬è‡ªå®šä¹‰äº‹ä»¶
                        window.addEventListener('storageStatusUpdated', function(e) {
                            console.log('ğŸ’¾ æ¬¢è¿æ¨¡å—ï¼šæ£€æµ‹åˆ°å­˜å‚¨çŠ¶æ€æ›´æ–°äº‹ä»¶');
                            updateStorageStatusFromCache();
                        });
                    }
                    
                    // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
                    function initializeStorageStatus() {
                        // ç«‹å³å°è¯•æ›´æ–°
                        updateStorageStatusFromCache();
                        
                        // è®¾ç½®ç›‘å¬å™¨
                        setupStorageStatusListener();
                        
                        // å»¶è¿Ÿé‡è¯•ï¼Œç¡®ä¿DOMå…ƒç´ å·²åŠ è½½
                        setTimeout(updateStorageStatusFromCache, 100);
                        setTimeout(updateStorageStatusFromCache, 500);
                        setTimeout(updateStorageStatusFromCache, 1000);
                        
                        // å¦‚æœè¿˜æ˜¯æ²¡æœ‰æ•°æ®ï¼Œç­‰å¾…æ›´é•¿æ—¶é—´åå†æ¬¡å°è¯•
                        setTimeout(() => {
                            if (!isInitialized) {
                                console.log('ğŸ’¾ æ¬¢è¿æ¨¡å—ï¼šå»¶è¿Ÿåˆå§‹åŒ–ï¼Œå†æ¬¡å°è¯•è·å–å­˜å‚¨çŠ¶æ€');
                                updateStorageStatusFromCache();
                            }
                        }, 3000);
                    }
                    
                    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
                    if (document.readyState === 'loading') {
                        document.addEventListener('DOMContentLoaded', initializeStorageStatus);
                    } else {
                        initializeStorageStatus();
                    }
                </script>
                
                <div class="status-card status-security">
                    <div class="status-icon">
                        <i class="fa fa-shield"></i>
                    </div>
                    <div class="status-info">
                        <div class="status-label">å®‰å…¨çŠ¶æ€</div>
                        <div class="status-value">å·²ä¿æŠ¤</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div> 